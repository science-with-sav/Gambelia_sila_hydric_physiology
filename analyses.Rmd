---
title: "BNLL hydrophysiology analyses"
author: "Savannah Weaver"
output: 
    pdf_document:
    toc: TRUE
---


# Packages

```{r setup, echo=T, results='hide', message=FALSE}
if (!require("tidyverse")) install.packages("tidyverse") 
library("tidyverse")# for dplyr workflow of calculations
if (!require("UsingR")) install.packages("UsingR") 
library("UsingR")
if (!require("MASS")) install.packages("MASS") 
library("MASS")
if (!require("lme4")) install.packages("lme4") 
library("lme4")
```


# Load in Data

This data was collected during fieldwork with Blunt-nosed Leopard Lizards (*Gambelia sila*) in the Elkhorn Plain of the Carrizo Plain National Monument in California, USA during the 2021 active season (April-August). See published paper (doi) for complete methods and discussion of these analyses. 


## Collared Lizards

The first dataset loaded in is for lizards we radio-collared and tracked throughout the summer.

```{r get data collared lizards}
lizards_collared <- read.csv("data/collared_measurements.csv") %>%
                
                # format data classes
  dplyr::mutate(capture_process_date_time = as.POSIXct(paste(capture_process_date, capture_time, sep = " "), format = "%m/%d/%y %H:%M"),
                # time with arbitrary date, need to figure out how to remove
                #capture_time = as.POSIXct(capture_time, format = "%H:%M"),
                #processing_time = as.POSIXct(processing_time, format = "%H:%M"),
                SVL_mm = as.numeric(SVL_mm),
                pre_tmt_mass_g = as.numeric(pre_tmt_mass_g),
                pre_mass_w_collar_Y_N = as.factor(pre_mass_w_collar_Y_N),
                post_tmt_mass_g = as.numeric(post_tmt_mass_g),
                post_mass_w_collar_Y_N = as.factor(post_mass_w_collar_Y_N),
                treatment_date_time = as.POSIXct(paste(treatment_date, processing_time, sep = " "), format = "%m/%d/%y %H:%M"),
                tmt_start_time = as.POSIXct(tmt_start_time, format = "%H:%M"),
                tmt_end_time = as.POSIXct(tmt_end_time, format = "%H:%M"),
                hematocrit_percent = as.numeric(hematocrit_percent),
                osmolality_mmol_kg = as.numeric(osmolality_mmol_kg),
                hemolyzed_Y_N = as.factor(hemolyzed_Y_N),
                cloacal_temp_C = as.numeric(cloacal_temp_C)
                ) %>%
  
  # add tmt group info
  left_join(read.csv("data/collared_identification.csv"),
            by = 'individual_ID') %>%
  
  # add osmolality values from blood samples
  #left_join(read.csv(osml)) %>%
  
  # add CEWL values from AquaFlux measurements
  #left_join(read.csv(CEWL)) %>%
  
                # format data classes
  dplyr::mutate(individual_ID = as.factor(individual_ID),
                sex_M_F = as.factor(sex),
                tmt = as.factor(tmt),
                radio_collar_mass_g = as.numeric(radio_collar_mass_g),
                
                #statistics
                capture_to_msmt = as.numeric(treatment_date_time - capture_process_date_time),
                tmt_time_elapsed = as.numeric(tmt_end_time - tmt_start_time),
                #test = capture_process_date == treatment_date,
                actual_pre_tmt_mass_g = pre_tmt_mass_g - radio_collar_mass_g*(pre_mass_w_collar_Y_N == "Y"),
                actual_post_tmt_mass_g = post_tmt_mass_g - radio_collar_mass_g*(post_mass_w_collar_Y_N == "Y"),
                tmt_mass_change_g = actual_post_tmt_mass_g - actual_pre_tmt_mass_g
                )

summary(lizards_collared)
```


## Widespread Lizards

The second dataset loaded in is for lizards we caught opportunistically and who we did not radio-collar or track throughout the summer.

```{r get data widespread lizards}
lizards_widespread <- read.csv("data/widespread_measurements.csv") %>%
  
                # format data classes
  dplyr::mutate(date = as.POSIXct(date, format = "%m/%d/%y"),
                # time with arbitrary date, need to figure out how to remove
                capture_time = as.POSIXct(capture_time, format = "%H:%M"),
                processing_time = as.POSIXct(processing_time, format = "%H:%M"),
                individual_ID = as.factor(individual_ID),
                SVL_mm = as.numeric(SVL_mm),
                mass_g = as.numeric(mass_g),
                sex_M_F = as.factor(sex_M_F),
                hematocrit_percent = as.numeric(hematocrit_percent),
                osmolality_mmol_kg = as.numeric(osmolality_mmol_kg),
                hemolyzed_Y_N = as.factor(hemolyzed.),
                cloacal_temp_C = as.numeric(cloacal_temp_C)
                ) %>%

  # add osmolality values from blood samples
  #left_join(read.csv(osml)) %>%
  
  # add CEWL values from AquaFlux measurements
  #left_join(read.csv(CEWL)) %>%

                #statistics
  dplyr::mutate(capture_to_msmt = as.numeric(processing_time - capture_time)
                )

summary(lizards_widespread)
```


## Variable Explanation



## Methods Stats

```{r capture to msmt}
# collared
mean(lizards_collared$capture_to_msmt, na.rm = TRUE)/60
median(lizards_collared$capture_to_msmt, na.rm = TRUE)/60
hist(lizards_collared$capture_to_msmt)
300/60

# widespread
mean(lizards_widespread$capture_to_msmt, na.rm = TRUE)
max(lizards_widespread$capture_to_msmt, na.rm = TRUE)
```

Most collared lizards were measured within 5 hours of capture, with the majority being measured within 2 hours of capture, and a few being measured the day after capture.

Widespread lizards were always measured within 5 hours of capture, and usually within 2 hours.

```{r tmt time}
mean(lizards_collared$tmt_time_elapsed, na.rm = T)
hist(lizards_collared$tmt_time_elapsed, na.rm = T)
```

Lizards were put in bins with shallow water for 1 hour, on average, to promote drinking behavior.


## Treatment Effects

Are there *ANY* differences between lizards who we gave water vs no water??

```{r tmt diffs}
lizards_collared %>%
  group_by(tmt, sex_M_F) %>%
  summarise(SVL_mean = mean(SVL_mm, na.rm = T),
            hct_mean = mean(hematocrit_percent, na.rm = T),
            osml_mean = mean(osmolality_mmol_kg, na.rm = T),
            mass_change_mean = mean(tmt_mass_change_g, na.rm = T)
            )
```

Potentially......

Are the widespread-caught lizards any different?

```{r wd diffs}
lizards_widespread %>%
  group_by(sex_M_F) %>%
  summarise(SVL_mean = mean(SVL_mm, na.rm = T),
            hct_mean = mean(hematocrit_percent, na.rm = T),
            osml_mean = mean(osmolality_mmol_kg, na.rm = T)
            )
```

Widespread lizards were simply the smaller ones that couldn't be radio-collared, so that's slightly different. Osmolality for those females seems higher than radio-collared control, but hct values seem on-par. 

We did recapture several widespread lizards, so I think it makes sense to put them on the same figures? Because that way, we can compare them to our control group. Maybe rename widespread -> "no intervention", control -> "sham tmt", and hydration -> "water tmt". :)


## Purge & Merge !

```{r p n m}

```






# Experimental Hydration Effects

map hct, osml, mass, and CEWL over time, lines by indiv, color by tmt/sex




































