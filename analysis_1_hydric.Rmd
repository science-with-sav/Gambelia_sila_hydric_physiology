---
title: "Blunt-nosed Leopard Lizard Data Analysis: Water Physiology Nuances"
author: "Savannah Weaver"
output: 
  rmdformats::html_clean:
    highlight: tango
    thumbnails: FALSE
    toc: TRUE
    toc_depth: 3
---


# Packages

```{r setup, echo=T, results='hide', message=FALSE}
if (!require("tidyverse")) install.packages("tidyverse") 
library("tidyverse")# for dplyr workflow of calculations
if (!require("UsingR")) install.packages("UsingR") 
library("UsingR")
if (!require("lme4")) install.packages("lme4") 
library("lme4")
if (!require("lmerTest")) install.packages("lmerTest") 
library("lmerTest")
if (!require("broom")) install.packages("broom")
library("broom") # lmer model export
if (!require("broom.mixed")) install.packages("broom.mixed")
library("broom.mixed") # lmer model export
if (!require("ggplot2")) install.packages("ggplot2")
library("ggplot2")
if (!require("RColorBrewer")) install.packages("RColorBrewer")
library("RColorBrewer")
if (!require("ggpubr")) install.packages("ggpubr")
library("ggpubr") # for multi-ggplot figs
if (!require("Hmisc")) install.packages("Hmisc")
library("Hmisc") # correlation matrix
if (!require("emmeans")) install.packages("emmeans")
library("emmeans") # marginal means & confints
```





# Set Colors & Themes

```{r}
savs_ggplot_theme <- theme_classic() + 
                     theme(text = element_text(color = "black", 
                                               family = "sans", 
                                               size = 12),
                           axis.text = element_text(color = "black", 
                                                    family = "sans", 
                                                    size = 8),
                           legend.text = element_text(color = "black", 
                                                      family = "sans", 
                                                      size = 8),
                           legend.text.align = 0,
                           legend.position = "bottom"
                           )
  
# custom colors
Male <- brewer.pal(11, "RdYlBu")[c(10)]
Fem <- brewer.pal(11, "RdYlBu")[c(3)]
Fem_grav <- brewer.pal(11, "RdYlBu")[c(2)]
Fem_nongrav <- brewer.pal(11, "RdYlBu")[c(4)]
my_colors <- c(Fem, Male)
my_shapes <- c(19,15)
my_shapes_open <- c(21,22)

# corr colors
n3 <- brewer.pal(11, "RdYlBu")[c(9, 10, 11)]
n2 <- brewer.pal(9, "YlGnBu")[c(6, 8)]
n1 <- brewer.pal(9, "YlGnBu")[c(6)]


# labels for plots for repeat measures lizards only
my_labels <- c("April\nF\n(n=11)", "April\nM\n(n=22)",
               "May\nF\n(n=10)", "May\nM\n(n=17)",
               "July\nF\n(n=2)", "July\nM\n(n=12)")
# labels for plots for full dataset of all lizards
my_labels_full <- c("April\nF\n(n=26)", "April\nM\n(n=41)",
                     "May\nF\n(n=15)", "May\nM\n(n=22)",
                     "July\nF\n(n=3)", "July\nM\n(n=12)")
my_labels_full_F <- c("April\n(n=26)",
                     "May\n(n=15)",
                     "July\n(n=3)")
my_labels_full_M <- c("April\n(n=41)",
                     "May\n(n=22)",
                     "July\n(n=12)")
```










# Background 

This data was collected on Blunt-nosed Leopard Lizards (*Gambelia sila*) during their active season in 2021. In this document, we will investigate the nuances and trends in the hydric physiology of these desert lizards. 

We will do some additional data wrangling (see other 'wrangling_' files in this repository for more details on data preparation), compute some initial summary statistics, and investigate the following questions:

- Are the different hydric physiology metrics we measured related to each other?
- Did our attempt at supplemental hydration actually do anything?
- How did hydric physiology change over time throughout the active season (April-July) of these lizards? This section composes the biggest chunk of this file.
- Does hydric physiology relate to reproductive ability or effort in any way?








# Load in Data


## Main Dataframe

```{r}
dat <- read_rds("./data/G_sila_clean_full_dat.RDS") %>%
  mutate(month_sex = factor(paste(month, sex_M_F),
                            levels = c("April Female", "April Male",
                                       "May Female", "May Male",
                                       "July Female", "July Male")),
         date_chunk_pretty = factor(case_when(month == "April" ~ "Apr 23-25",
                                              month == "May" ~ "May 7-9",
                                              month == "July" ~ "Jul 14"),
                                    levels = c("Apr 23-25", "May 7-9", "Jul 14")),
         gravid_Y_N = factor(gravid_Y_N, levels = c("Not Gravid", "Gravid")))
summary(dat)
unique(dat$radio_collar_serial)

dat_F <- dat %>%
  dplyr::filter(sex_M_F == "Female")
dat_M <- dat %>%
  dplyr::filter(sex_M_F == "Male")

# summary statistics
dat %>%
  summarise(mean(CEWL_g_m2h, na.rm = T), sd(CEWL_g_m2h, na.rm = T),
            mean(osmolality_mmol_kg_mean, na.rm = T), 
            sd(osmolality_mmol_kg_mean, na.rm = T),
            mean(hematocrit_percent, na.rm = T), sd(hematocrit_percent, na.rm = T),
            mean(mass_g), sd(mass_g),
            mean(SVL_mm), sd(SVL_mm),
            mean(SMI), sd(SMI))
```




## Variable Explanation

This is an explanation of each variable in our dataframe:

- "capture_date_time" 
- "capture_date"                
- "radio_collar_serial"          
- "PIT_tag_ID"                  
- "individual_ID"                
- "sex_M_F"                     
- "mass_g"                      
- "SVL_mm"                      
- "tmt"                          
- "tmt_mass_change_g"           
- "capture_to_msmt"              
- "hematocrit_percent"          
- "cloacal_temp_C"              
- "CEWL_g_m2h"                  
- "msmt_temp_C"                  
- "msmt_RH_percent"             
- "e_s_kPa"                      
- "msmt_VPD_kPa"                
- "osmolality_mmol_kg_mean"      
- "month"                       
- "week"                         
- "week_num"                    
- "ultrasound_date"              
- "gravid_Y_N"                  
- "number_eggs"                  
- "largest_egg_diameter_cm"     
- "largest_egg_circumference_cm" 
- "stage"                       
- "dev_point"                    
- "SMI"                         
- "month_sex"                    
- "date_chunk_pretty"     




## Repeat Subset

I want to make some sub-dataframes for when I want to do stats for only a subset of individuals.

First, get a dataframe of only individuals that had more than one measurement taken, and note how many individuals had each n measurements:

```{r}
# how many lizards were measured 1, 2, or 3 times?
note_repeats <- dat %>%
  group_by(individual_ID) %>%
  summarise(n = n()) %>%
  group_by(n) %>%
  summarise(n_lizards = n())
note_repeats 

# this is how many individual lizards we measured :)
sum(note_repeats$n_lizards) 

# get subsetted data
dat_repeats <- dat %>%
  group_by(individual_ID) %>%
  mutate(n = n()) %>%
  dplyr::filter(n>1)

# check these match 'note_repeats'
dat_repeats %>%
  group_by(individual_ID) %>%
  summarise(n = n()) %>%
  group_by(n) %>%
  summarise(n_lizards = n())
```



## Female Subset

To look at reproductive effort ~ water balance, I will make another subset for only the females we collected gravidity/egg data on:

```{r}
dat_repro_females <- dat %>%
  dplyr::filter(sex_M_F == "Female") %>%
  dplyr::filter(complete.cases(gravid_Y_N)) %>%
  group_by(individual_ID) %>%
  mutate(n = n(),
         n = factor(n)) 
summary(dat_repro_females)
```


It's good to note that I measured reproductive effort at **two time points** for 9 females, and only at one time point for 10 females.

Check whether the single-measurement females are all from the first weekend or not:

```{r}
table(dat_repro_females$week, dat_repro_females$n)
dat_repro_females %>%
  dplyr::filter(n == 1) %>%
  summary() # 4 g, 6 ng
dat_repro_females %>%
  dplyr::filter(n == 2) %>%
  dplyr::filter(week == 3) %>%
  summary() # 8 g, 1 ng
table(dat_repro_females$gravid_Y_N, dat_repro_females$n)
```


For the females who were only measured once, 8 of them are from the first weekend and 2 of them are from the third weekend.

Also save a subset of the females that were measured twice:


```{r}
dat_repeat_females <- dat_repro_females %>%
  dplyr::filter(n == 2)
```




















# Does SVL change over time?

I want to know whether SVL changed over time for the individuals who had more than one measurement taken. 

```{r}
# model
summary(lmerTest::lmer(data = dat_repeats, 
                   SVL_mm ~ week_num + (1|individual_ID)))
```


There is no meaningful change in SVL for the individuals we were able to measure, so I could use either mass or body condition to estimate change in body size over time.



# Check CEWL Covariates

How much is CEWL impacted by the body temperature, ambient temperature, and ambient VPD at the time of CEWL measurement? I will investigate this using *all* measurements.

It's possible that I may find a relationship between ambient temp and CEWL but not body temp and CEWL because the body temp measurements we took were unfortunately only to the nearest degree (vs tenth of a degree).


## Plot

First, make a simple plot of each to look for relationships visually.

```{r}
ggplot(dat) +
  aes(x = cloacal_temp_C,
      y = CEWL_g_m2h,
      color = week
      #color = sex_M_F
        ) +
  geom_point() +
  geom_smooth(method = "lm") +
  theme_bw()
ggplot(dat) +
  aes(x = msmt_temp_C,
      y = CEWL_g_m2h,
      color = week
      #color = sex_M_F
        ) +
  geom_point() +
  geom_smooth(method = "lm") +
  theme_bw()
ggplot(dat) +
  aes(x = msmt_VPD_kPa,
      y = CEWL_g_m2h,
      color = week
      #color = sex_M_F
        ) +
  geom_point() +
  geom_smooth(method = "lm") +
  theme_bw()
```


Across dates, CEWL had no relationship with body temp, ambient temp, or ambient VPD at the time of capture. However, when separated by date, there were relationships. CEWL had a positive relationship with body temp, ambient temp, and ambient VPD, but only for week 3 measurements. There were no relationships when separated by treatment group. 


## Models

Now, check linear models of the effect of each of body temp, ambient temp, and ambient VPD with the interaction of date on CEWL.

```{r}
CEWL_cov_check_clotemp <- lm(data = dat,
           CEWL_g_m2h ~ cloacal_temp_C*week)
summary(CEWL_cov_check_clotemp)
CEWL_cov_check_msmttemp <- lm(data = dat,
           CEWL_g_m2h ~ msmt_temp_C*week)
summary(CEWL_cov_check_msmttemp)
CEWL_cov_check_VPD <- lm(data = dat,
           CEWL_g_m2h ~ msmt_VPD_kPa*week)
summary(CEWL_cov_check_VPD)

# F stats
anova(CEWL_cov_check_clotemp)
anova(CEWL_cov_check_msmttemp)
anova(CEWL_cov_check_VPD)
```

CEWL had a positive relationship with each of body temp, ambient temp, and ambient VPD, *but only for the measurements taken in May* (week 3).


## Variance

Let's also check the distribution/range of these covariates, because based on the figures, week 3 had a pretty small range of temperatures and VPDs.

```{r}
dat %>%
  group_by(week) %>%
  summarise(ctemp_range = max(cloacal_temp_C, na.rm = T) - 
              min(cloacal_temp_C, na.rm = T),
            mtemp_range = max(msmt_temp_C, na.rm = T) - 
              min(msmt_temp_C, na.rm = T),
            mVPD_range = max(msmt_VPD_kPa, na.rm = T) - 
              min(msmt_VPD_kPa, na.rm = T))
```

Well... the ranges for week 3 are not small enough to be meaningless. So, we will have to keep in mind that temperature and VPD should be retained in CEWL models as a covariate.

















# Water Balance Metrics

What is the interrelation among water balance metrics CEWL, osmolality, hematocrit, and mass/SMI. I'll use all measurements for this.


## Models

Check a simple linear model between each set of paired measurements. I started with full models that included interactions with month and sex for each relationship, then dropped if the interaction was not significant. So, the models that still have interaction effects have them because they are important, and the models that do not have interaction effects had those effects dropped because they were not important.

```{r}
# CEWL ~
anova(lm(data = dat,
           CEWL_g_m2h ~ osmolality_mmol_kg_mean*month))
summary(lm(data = dat,
           CEWL_g_m2h ~ osmolality_mmol_kg_mean*month*sex_M_F))
anova(lm(data = dat,
           CEWL_g_m2h ~ hematocrit_percent))
anova(lm(data = dat,
           CEWL_g_m2h ~ mass_g))
anova(lm(data = dat,
           CEWL_g_m2h ~ SMI))

# osmolality ~
anova(lm(data = dat,
           osmolality_mmol_kg_mean ~ hematocrit_percent))
anova(lm(data = dat,
           osmolality_mmol_kg_mean ~ mass_g))
anova(lm(data = dat,
           osmolality_mmol_kg_mean ~ SMI))

# hct
anova(lm(data = dat,
           hematocrit_percent ~ SMI*sex_M_F))
```

Notes on these relationships:

- CEWL ~ osml had significant interaction of osml* month (osml* mo* sex was not sig)
- CEWL ~ hct was sig but had no extra interactions (plot direct relationship only)
- CEWL ~ SMI was sig (mass was not; & SMI did not interact with mo or sex)
- osml & hct corr, but with no interactions of mo or sex
- osml also corr with SMI but not mass (& no interactions with mo or sex)
- **^all of the above based on anova SS, so assessing whether these things explain variation in response (CEWL/osml)**

For MS:

- Plasma osmolality explained a significant amount of the variation in CEWL (SLR: F(1,110) = 5.07, p = 0.03), with a marginally nonsignificant interaction with measurement time period (SLR: F(2,110) = 2.77, p = 0.07). 
- CEWL could also be explained by hematocrit (SLR: F(1,114) = 9.86, p = 0.002), or body condition (SLR: F(1,116) = 3.89, p = 0.05), but not lizard mass (SLR: F(1,116) = 1.44, p = 0.2). 
- Variation in plasma osmolality could be explained by hematocrit (SLR: F(1,114) = 15.07, p < 0.001) or body condition (SLR: F(1,114) = 5.30, p = 0.02), but not lizard mass (SLR: F(1,114) < 0.001, p = 1). 
- Hematocrit and body condition were also significantly related (SLR: F(1,112) = 9.03, p = 0.003), with an interaction of lizard sex (SLR: F(1,112) = 7.97, p = 0.005). 





## Plots

### CEWL ~ Osmolality


```{r CEWL osml fig}
ggplot(dat) + 
  aes(x = osmolality_mmol_kg_mean,
      y = CEWL_g_m2h,
      color = month,
      shape = month
      ) +
  geom_point(alpha = 0.5) + 
  stat_smooth(formula = y ~ x, 
              method = "lm", 
              se = F, 
              alpha = 0.8) + 
  scale_color_manual(values = n3, name = NULL
                     #name = "Measurement\nPeriod"
                     ) + 
  scale_shape_manual(values = c(15, 16, 17), name = NULL) +
  labs(x = bquote('Plasma Osmolality (mmol '*kg^-1*')'),
       y = bquote('CEWL (g '*m^-2*' '*h^-1*')')) +
  #guides(color = guide_legend(nrow = 1, byrow = TRUE),
   #      #fill = guide_legend(title.position = "left") # makes color ramp weird
    #     ) +
  scale_x_continuous(limits = c(300, 450),
                     breaks = c(300, 350, 400, 450),
                     labels = c(300, 350, 400, 450)) +
  savs_ggplot_theme -> CEWL_osml_fig
CEWL_osml_fig

# arrange to get legend centered
ggarrange(CEWL_osml_fig,
          ncol = 1, nrow = 1,
          common.legend = TRUE,
          legend = "bottom"
          ) -> CEWL_osml_fig_arrange

# export figure
ggsave(filename = "CEWL_osml_fig.pdf",
       plot = CEWL_osml_fig_arrange,
       path = "./results_figures",
       device = "pdf",
       dpi = 600,
       units = "mm",
       width = 80, height = 80)
```


### CEWL ~ SMI


```{r CEWL SMI fig}
ggplot(dat) + 
  aes(x = SMI,
      y = CEWL_g_m2h,
      #color = tmt
      #color = month_sex
      ) +
  geom_point(size = 1, 
             alpha = 0.4) + 
  stat_smooth(formula = y ~ x, 
              method = "lm", 
              se = F, 
              size = 1.6, 
              alpha = 1,
              color = n1) + 
  xlab("Body Condition (g')") + 
  ylab(bquote('CEWL (g/'*m^2*'h)')) + 
  #ylab("") +
  #xlim(300, 450) +
  #annotate(geom = "text", x = 430, y = 24, label = bquote(''*R^2*'=0.033'), 
   #        size = 7) +
  #ylim(0, 25) +
  savs_ggplot_theme -> CEWL_SMI_fig
CEWL_SMI_fig
```



### CEWL ~ Hematocrit


```{r CEWL hct fig}
ggplot(dat) + 
  aes(x = hematocrit_percent,
      y = CEWL_g_m2h,
      #color = tmt
      #color = month_sex
      ) +
  geom_point(size = 1, 
             alpha = 0.4) + 
  stat_smooth(formula = y ~ x, 
              method = "lm", 
              se = F, 
              size = 1.6, 
              alpha = 1,
              color = n1) + 
  xlab("Hematocrit (%)") + 
  ylab(bquote('CEWL (g/'*m^2*'h)')) + 
  #ylab("") +
  #xlim(300, 450) +
  #annotate(geom = "text", x = 430, y = 24, label = bquote(''*R^2*'=0.033'), 
   #        size = 7) +
  #ylim(0, 25) +
  savs_ggplot_theme -> CEWL_hct_fig
CEWL_hct_fig
```








### Osmol ~ SMI


```{r osml SMI fig}
ggplot(dat) + 
  aes(x = SMI,
      y = osmolality_mmol_kg_mean,
      #color = tmt
      #color = month_sex
      ) +
  geom_point(size = 1, 
             alpha = 0.4) + 
  stat_smooth(formula = y ~ x, 
              method = "lm", 
              se = F, 
              size = 1.6, 
              alpha = 1,
              color = n1) + 
  xlab("Body Condition (g')") + 
  ylab("Osmolality (mmol/kg)") + 
  #ylab("") +
  #xlim(300, 450) +
  #annotate(geom = "text", x = 430, y = 24, label = bquote(''*R^2*'=0.033'), 
   #        size = 7) +
  #ylim(0, 25) +
  savs_ggplot_theme -> osml_SMI_fig
osml_SMI_fig
```






### Osmol ~ Hematocrit


```{r osml hct fig}
ggplot(dat) + 
  aes(x = hematocrit_percent,
      y = osmolality_mmol_kg_mean,
      #color = tmt
      #color = month_sex
      ) +
  geom_point(size = 1, 
             alpha = 0.4) + 
  stat_smooth(formula = y ~ x, 
              method = "lm", 
              se = F, 
              size = 1.6, 
              alpha = 1,
              color = n1) + 
  xlab("Hematocrit (%)") + 
  ylab("Osmolality (mmol/kg)") + 
  #ylab("") +
  #xlim(300, 450) +
  #annotate(geom = "text", x = 430, y = 24, label = bquote(''*R^2*'=0.033'), 
   #        size = 7) +
  #ylim(0, 25) +
  scale_color_manual(values = n1) + 
  savs_ggplot_theme -> osml_hct_fig
osml_hct_fig
```







### Hct ~ SMI


```{r hct SMI fig}
ggplot(dat) + 
  aes(x = SMI,
      y = hematocrit_percent,
      color = sex_M_F,
      #color = month_sex
      ) +
  geom_point(size = 1, 
             alpha = 0.4) + 
  stat_smooth(formula = y ~ x, 
              method = "lm", 
              se = F, 
              size = 1.6, 
              alpha = 1) + 
  xlab("Body Condition (g')") + 
  ylab("Hematocrit (%)") + 
  #ylab("") +
  #xlim(300, 450) +
  #annotate(geom = "text", x = 430, y = 24, label = bquote(''*R^2*'=0.033'), 
   #        size = 7) +
  #ylim(0, 25) +
  scale_color_manual(values = n2) +
  savs_ggplot_theme -> hct_SMI_fig
hct_SMI_fig
```


















## Lag (delete?)

What if I tested week 3 CEWL ~ week 1 osml, or visa versa? This is to look for a lag effect on their relationship, although the time period is likely too long.

First, organize the data:

```{r}
w3_CEWL <- dat %>%
  dplyr::filter(week == 3) %>%
  dplyr::select(individual_ID, CEWL_g_m2h)
w1_osml <- dat %>%
  dplyr::filter(week == 1) %>%
  dplyr::select(individual_ID, osmolality_mmol_kg_mean)
w3_vs_w1 <- w1_osml %>%
  left_join(w3_CEWL, by = 'individual_ID') %>%
  dplyr::filter(complete.cases(osmolality_mmol_kg_mean, CEWL_g_m2h))
w1_CEWL <- dat %>%
  dplyr::filter(week == 1) %>%
  dplyr::select(individual_ID, CEWL_g_m2h)
w3_osml <- dat %>%
  dplyr::filter(week == 3) %>%
  dplyr::select(individual_ID, osmolality_mmol_kg_mean) 
w1_vs_w3 <- w3_osml %>%
  left_join(w1_CEWL, by = 'individual_ID') %>%
  dplyr::filter(complete.cases(osmolality_mmol_kg_mean, CEWL_g_m2h))
```


Run models:

```{r}
summary(lm(data = w3_vs_w1, CEWL_g_m2h ~ osmolality_mmol_kg_mean))
summary(lm(data = w1_vs_w3, CEWL_g_m2h ~ osmolality_mmol_kg_mean))
```

It seems very unlikely there is a lag effect, at least at this time scale. t and F stats were both nonsig for each comparisons.














# Supplemental Hydration Treatment Effects

We tried to give the lizards water to drink. Did they actually drink any? And did it affect measurable change in their physiology?





## Calculate Deltas

First, calculate the change in CEWL, osmolality, and mass for each treatment individual that was recaptured between April and May.

```{r}
# get the intitial values from April
starting_values <- dat_repeats %>%
  # look only at lizards in hydration or sham tmt
  dplyr::filter(tmt != "No Tmt") %>%
  # get the values for April measurements only 
  dplyr::filter(month == "April") %>%
  dplyr::select(individual_ID,
                CEWL_April = CEWL_g_m2h,
                osml_April = osmolality_mmol_kg_mean,
                mass_April = mass_g)

# calculate deltas
dat_tmt_change <- dat_repeats %>%
  # look only at lizards in hydration or sham tmt
  dplyr::filter(tmt != "No Tmt") %>%
  # add starting values
  left_join(starting_values, by = 'individual_ID') %>%
  # make sure we have complete data
  dplyr::filter(complete.cases(mass_April, CEWL_April)) %>%
  # calculate difference for each msmt versus in April
  mutate(mass_change_from_April = mass_g - mass_April,
         CEWL_change_from_April = CEWL_g_m2h - CEWL_April,
         osml_change_from_April = osmolality_mmol_kg_mean - osml_April)

# subset of data to look at change April->May only
dat_tmt_change_May_only <- dat_tmt_change %>%
  dplyr::filter(month == "May")
```


  


## Tmt Effect Check


What was mass change *during* treatment, when we either gave lizards water to drink or a sham treatment?

This quantifies the difference in mass gain/loss when we gave them water to drink versus sham treatment.

```{r tmt mass change stats}
tmt_change <- lm(data = dat_tmt_change, tmt_mass_change_g ~ tmt)
summary(tmt_change)
emmeans(tmt_change, "tmt")
```

So, it did result in a significant change in mass within the same-day water supplementation tmt (vs sham), but only ~1.4g difference, on average.








## Plot Change ~ Tmt

### Mass

```{r}
ggplot(dat_tmt_change) +
  aes(x = month,
      y = mass_change_from_April,
      group = individual_ID,
      color = tmt
      ) +
  xlab("Measurement Month") + 
  ylab(expression(Delta ~ 'Lizard Mass (g)')) +
  geom_line(alpha = 0.5) +
  geom_point(size = 1.5) +
  scale_color_manual(values = my_colors, name = "Sex") +
  savs_ggplot_theme -> tmt_delta_mass
tmt_delta_mass
```


### Osmolality

```{r}
ggplot(dat_tmt_change) +
  aes(x = month,
      y = osml_change_from_April,
      group = individual_ID,
      color = tmt
      ) +
  xlab("Measurement Month") + 
  ylab(expression(Delta ~ 'Osmolality (mmol '*kg^-1*')')) +
  geom_line(alpha = 0.5) +
  geom_point(size = 1.5) +
  scale_color_manual(values = my_colors, name = "Sex") +
  savs_ggplot_theme -> tmt_delta_osml
tmt_delta_osml
```




### CEWL

```{r}
ggplot(dat_tmt_change) +
  aes(x = month,
      y = CEWL_change_from_April,
      group = individual_ID,
      color = tmt
      ) +
  xlab("Measurement Month") + 
  ylab(expression(Delta ~ 'CEWL (g '*m^-2*' '*h^-1*')')) +
  geom_line(alpha = 0.5) +
  geom_point(size = 1.5) +
  scale_color_manual(values = my_colors, name = "Sex") +
  savs_ggplot_theme -> tmt_delta_CEWL
tmt_delta_CEWL
```


It does *not* look like treatment led to any differences in the amount or direction of change in lizard mass, CEWL, or osmolality. Changes were also not consistent by sex.




## Export Multi-Panel Fig

Save plots:

```{r}
ggarrange(tmt_delta_CEWL,
          tmt_delta_osml, 
          tmt_delta_mass,
          ncol = 1, nrow = 3,
          labels = c("A", "B", "C"),
          common.legend = TRUE,
          legend = "bottom"
          ) -> tmt_delta_multi_fig
tmt_delta_multi_fig

#ggsave(filename = "tmt_delta_multi_fig.pdf",
 #      plot = tmt_delta_multi_fig,
  #     path = "./results_figures",
   #    device = "pdf",
    #   dpi = 600,
     #  units = "mm",
      # width = 80, height = 210)
```



## Stat Tests of Change

Quantify whether change over time differed based on treatment.

These lm's are doing the same thing as a two-sample t-test, checking whether the means are statistically different. 

```{r}
summary(lm(data = dat_tmt_change_May_only, mass_change_from_April ~ tmt))
summary(lm(data = dat_tmt_change_May_only, CEWL_change_from_April ~ tmt))
summary(lm(data = dat_tmt_change_May_only, osml_change_from_April ~ tmt))
# stats in paper are from these 3 models
summary(lm(data = dat_tmt_change, mass_change_from_April ~ tmt))
summary(lm(data = dat_tmt_change, CEWL_change_from_April ~ tmt))
summary(lm(data = dat_tmt_change, osml_change_from_April ~ tmt))
```

Change was not significantly different between treatments for any of the variables. 


Was change overall (across tmts) different from zero?

```{r}
t.test(dat_tmt_change_May_only$mass_change_from_April)
t.test(dat_tmt_change_May_only$CEWL_change_from_April)
t.test(dat_tmt_change_May_only$osml_change_from_April)
```

On average, lizards who were measured in both April and May increased mass, but did not experience a change in osmolality or CEWL. 














# Change Over Time

Did hydric physiology change throughout these lizards' active season?


## Plot Delta ~ Time*Sex

### Mass

```{r}
ggplot(dat_tmt_change) +
  aes(x = month,
      y = mass_change_from_April,
      group = individual_ID,
      color = sex_M_F,
      shape = sex_M_F
      ) +
  xlab("Measurement Month") + 
  ylab(expression(Delta ~ 'Lizard Mass (g)')) +
  geom_line(alpha = 0.5) +
  geom_point(size = 1.5) +
  scale_color_manual(values = my_colors, name = "Sex") +
  scale_shape_manual(values = my_shapes, name = "Sex") +
  savs_ggplot_theme -> delta_mass_sex
delta_mass_sex
```


### Osmolality

```{r}
ggplot(dat_tmt_change) +
  aes(x = month,
      y = osml_change_from_April,
      group = individual_ID,
      color = sex_M_F,
      shape = sex_M_F
      ) +
  xlab("Measurement Month") + 
  ylab(expression(Delta ~ 'Osmolality (mmol '*kg^-1*')')) +
  geom_line(alpha = 0.5) +
  geom_point(size = 1.5) +
  scale_color_manual(values = my_colors, name = "Sex") +
  scale_shape_manual(values = my_shapes, name = "Sex") +
  savs_ggplot_theme -> delta_osml_sex
delta_osml_sex
```




### CEWL

```{r}
ggplot(dat_tmt_change) +
  aes(x = month,
      y = CEWL_change_from_April,
      group = individual_ID,
      color = sex_M_F,
      shape = sex_M_F
      ) +
  xlab("Measurement Month") + 
  ylab(expression(Delta ~ 'CEWL (g '*m^-2*' '*h^-1*')')) +
  geom_line(alpha = 0.5) +
  geom_point(size = 1.5) +
  scale_color_manual(values = my_colors, name = "Sex") +
  scale_shape_manual(values = my_shapes, name = "Sex") +
  savs_ggplot_theme -> delta_CEWL_sex
delta_CEWL_sex
```



## Export Multi-Panel Fig

Save plots:

```{r}
ggarrange(delta_CEWL_sex,
          delta_osml_sex, 
          delta_mass_sex,
          ncol = 3, nrow = 1,
          #ncol = 1, nrow = 3,
          labels = c("A", "B", "C"),
          common.legend = TRUE,
          legend = "bottom"
          ) -> delta_multi_fig_sex

ggsave(filename = "delta_multi_fig_sex.pdf",
       plot = delta_multi_fig_sex,
       path = "./results_figures",
       device = "pdf",
       dpi = 600,
       units = "mm",
       width = 200, height = 80
       #width = 80, height = 210
       )
```





## Time*Sex Marginal Means

I want to know whether the average values for the lizards we measured changes over time. To test this, I can run a linear model, then use emmeans to get the marginal means and confidence intervals for each time point. 

**Do this only for lizards with repeat measurements.**

info for using emmeans with interactions:
https://cran.r-project.org/web/packages/emmeans/vignettes/interactions.html


Check n's:

```{r}
dat_repeats %>%
  group_by(month, sex_M_F) %>%
  summarise(n = n())
```




### Mass

```{r}
time_sex_diffs_mass <- lmerTest::lmer(data = dat_repeats, mass_g ~ month*sex_M_F +
                                        (1|individual_ID))
anova(time_sex_diffs_mass, type = "1", ddf = "Kenward-Roger")

# mean values
emmeans_mass <- data.frame(emmeans(time_sex_diffs_mass, 
                                   pairwise ~ month | sex_M_F)$emmean) %>%
  mutate(measurement = "Mass")

# stat diffs by month
time_emmeans_mass <- data.frame(emmeans(time_sex_diffs_mass, 
                                   pairwise ~ month | sex_M_F)$contrasts) %>%
  mutate(measurement = "Mass")

# stat diffs by sex
sex_emmeans_mass <- data.frame(emmeans(time_sex_diffs_mass, 
                                   pairwise ~ sex_M_F | month)$contrasts) %>%
  mutate(measurement = "Mass")
```


### Body Condition

```{r}
time_sex_diffs_SMI <- lmerTest::lmer(data = dat_repeats, SMI ~ month*sex_M_F +
                                        (1|individual_ID))
anova(time_sex_diffs_SMI, type = "1", ddf = "Kenward-Roger")

# mean values
emmeans_SMI <- data.frame(emmeans(time_sex_diffs_SMI, 
                                   pairwise ~ month | sex_M_F)$emmean) %>%
  mutate(measurement = "SMI")

# stat diffs by month
time_emmeans_SMI <- data.frame(emmeans(time_sex_diffs_SMI, 
                                   pairwise ~ month | sex_M_F)$contrasts) %>%
  mutate(measurement = "SMI")

# stat diffs by sex
sex_emmeans_SMI <- data.frame(emmeans(time_sex_diffs_SMI, 
                                   pairwise ~ sex_M_F | month)$contrasts) %>%
  mutate(measurement = "SMI")
```




### Osmolality

*Remember, for some reason VPD was very significant when added to the osmolality lm...*

```{r}
time_sex_diffs_osml <- lmerTest::lmer(data = dat_repeats, 
                                      osmolality_mmol_kg_mean ~ month*sex_M_F +
                                        (1|individual_ID))
anova(time_sex_diffs_osml, type = "1", ddf = "Kenward-Roger")

# mean values
emmeans_osml <- data.frame(emmeans(time_sex_diffs_osml, 
                                   pairwise ~ month | sex_M_F)$emmean) %>%
  mutate(measurement = "Osmolality")

# stat diffs by month
time_emmeans_osml <- data.frame(emmeans(time_sex_diffs_osml, 
                                   pairwise ~ month | sex_M_F)$contrasts) %>%
  mutate(measurement = "Osmolality")

# stat diffs by sex
sex_emmeans_osml <- data.frame(emmeans(time_sex_diffs_osml, 
                                   pairwise ~ sex_M_F | month)$contrasts) %>%
  mutate(measurement = "Osmolality")
```




### CEWL

```{r}
time_sex_diffs_CEWL <- lmerTest::lmer(data = dat_repeats, 
                                      CEWL_g_m2h ~ month*sex_M_F +
                                        (1|individual_ID))
anova(time_sex_diffs_CEWL, type = "1", ddf = "Kenward-Roger")

# check covariates
time_sex_diffs_CEWL_check_covaries <- lmerTest::lmer(data = dat_repeats, 
                                                     CEWL_g_m2h ~ month*sex_M_F
                                         + msmt_temp_C + msmt_VPD_kPa +
                                        (1|individual_ID))
anova(time_sex_diffs_CEWL_check_covaries, type = "1", ddf = "Kenward-Roger") # not important at all
59/0.09 # 655.5
54/0.14 # 385.7

# mean values
emmeans_CEWL <- data.frame(emmeans(time_sex_diffs_CEWL, 
                                   pairwise ~ month | sex_M_F)$emmean) %>%
  mutate(measurement = "CEWL")

# stat diffs by month
time_emmeans_CEWL <- data.frame(emmeans(time_sex_diffs_CEWL, 
                                   pairwise ~ month | sex_M_F)$contrasts) %>%
  mutate(measurement = "CEWL")

# stat diffs by sex
sex_emmeans_CEWL <- data.frame(emmeans(time_sex_diffs_CEWL, 
                                   pairwise ~ sex_M_F | month)$contrasts) %>%
  mutate(measurement = "CEWL")
```



## Check Assumptions

```{r}
plot(time_sex_diffs_CEWL)
plot(time_sex_diffs_osml)
plot(time_sex_diffs_mass)
plot(time_sex_diffs_SMI)
```



## Merge dfs

```{r}
emmeans_all <- emmeans_CEWL %>%
  rbind(emmeans_osml) %>%
  rbind(emmeans_mass) %>%
  rbind(emmeans_SMI) %>%
  mutate(month_sex = factor(paste(month, sex_M_F),
                            levels = c("April Female", "April Male",
                                       "May Female", "May Male",
                                       "July Female", "July Male")))

# all pairwise stats together
emmean_time_stats <- time_emmeans_CEWL %>%
  rbind(time_emmeans_osml) %>%
  rbind(time_emmeans_mass) %>%
  rbind(time_emmeans_SMI)
emmean_sex_stats <- sex_emmeans_CEWL %>%
  rbind(sex_emmeans_osml) %>%
  rbind(sex_emmeans_mass) %>%
  rbind(sex_emmeans_SMI)
```







## Plot MMeans ~ Time*Sex

These are plots of the marginal means, only for the dataset of lizards with repeat measurements.


### Mass

```{r}
ggplot() +
  geom_jitter(data = dat_repeats,
             aes(x = month_sex,
                 y = mass_g,
                 shape = sex_M_F,
                 color = sex_M_F,
                 fill = sex_M_F),
             alpha = 0.3,
             size = 0.9,
              position = position_jitter(height = 0, width = 0.2)) +
  geom_point(data = emmeans_all[emmeans_all$measurement == "Mass",],
             aes(x = month_sex,
                 y = emmean,
                 shape = sex_M_F,
                 color = sex_M_F,
                 fill = sex_M_F),
             alpha = 1,
             size = 2) +
  geom_errorbar(data = emmeans_all[emmeans_all$measurement == "Mass",],
                aes(x = month_sex,
                    y = emmean, 
                    ymin = lower.CL,
                    ymax = upper.CL,
                 color = sex_M_F),
                width = .4) +
  xlab("") + 
  ylab("Lizard Mass (g)") +
  # sex differences = NONE
  # time differences for MALES
  annotate(geom = "text", x = 2, y = 61, label = "A", size = 3) +
  annotate(geom = "text", x = 4, y = 61, label = "A", size = 3) +
  annotate(geom = "text", x = 6, y = 61, label = "A", size = 3) +
  # time differences for FEMALES
  annotate(geom = "text", x = 1, y = 61, label = "a", size = 3) +
  annotate(geom = "text", x = 3, y = 61, label = "b", size = 3) +
  annotate(geom = "text", x = 5, y = 61, label = "c", size = 3) +
  scale_color_manual(values = my_colors, name = "Sex") +
  scale_fill_manual(values = my_colors, name = "Sex") +
  scale_shape_manual(values = my_shapes_open, name = "Sex") +
  scale_x_discrete(labels = my_labels) +
  ylim(17, 61) +
  savs_ggplot_theme -> mass_emmean_plot
mass_emmean_plot
```



### Body Condition

```{r}
ggplot() +
  geom_jitter(data = dat_repeats,
             aes(x = month_sex,
                 y = SMI,
                 shape = sex_M_F,
                 color = sex_M_F,
                 fill = sex_M_F),
             alpha = 0.3,
             size = 0.9,
              position = position_jitter(height = 0, width = 0.2)) +
  geom_point(data = emmeans_all[emmeans_all$measurement == "SMI",],
             aes(x = month_sex,
                 y = emmean,
                 shape = sex_M_F,
                 color = sex_M_F,
                 fill = sex_M_F),
             alpha = 1,
             size = 2) +
  geom_errorbar(data = emmeans_all[emmeans_all$measurement == "SMI",],
                aes(x = month_sex,
                    y = emmean, 
                    ymin = lower.CL,
                    ymax = upper.CL,
                 color = sex_M_F),
                width = .4) +
  xlab("") + 
  ylab("Body Condition (g')") +
  # sex differences
  annotate(geom = "text", x = 3.5, y = 45, label = "*", size = 6) +
  # time differences for MALES
  annotate(geom = "text", x = 2, y = 54, label = "AB", size = 3) +
  annotate(geom = "text", x = 4, y = 54, label = "A", size = 3) +
  annotate(geom = "text", x = 6, y = 54, label = "B", size = 3) +
  # time differences for FEMALES
  annotate(geom = "text", x = 1, y = 54, label = "a", size = 3) +
  annotate(geom = "text", x = 3, y = 54, label = "b", size = 3) +
  annotate(geom = "text", x = 5, y = 54, label = "a", size = 3) +
  scale_color_manual(values = my_colors, name = "Sex") +
  scale_fill_manual(values = my_colors, name = "Sex") +
  scale_shape_manual(values = my_shapes_open, name = "Sex") +
  scale_x_discrete(labels = my_labels) +
  ylim(20, 55) +
  savs_ggplot_theme -> SMI_emmean_plot
SMI_emmean_plot
```





### Osmolality

```{r}
ggplot() +
  geom_jitter(data = dat_repeats,
             aes(x = month_sex,
                 y = osmolality_mmol_kg_mean,
                 shape = sex_M_F,
                 color = sex_M_F,
                 fill = sex_M_F),
             alpha = 0.3,
             size = 0.9,
              position = position_jitter(height = 0, width = 0.2)) +
  geom_point(data = emmeans_all[emmeans_all$measurement == "Osmolality",],
             aes(x = month_sex,
                 y = emmean,
                 shape = sex_M_F,
                 color = sex_M_F,
                 fill = sex_M_F),
             alpha = 1,
             size = 2) +
  geom_errorbar(data = emmeans_all[emmeans_all$measurement == "Osmolality",],
                aes(x = month_sex,
                    y = emmean, 
                    ymin = lower.CL,
                    ymax = upper.CL,
                 color = sex_M_F),
                width = .4) +
  xlab("") + 
  ylab(bquote('Osmolality (mmol '*kg^-1*')')) +
  # sex differences
  annotate(geom = "text", x = 1.5, y = 416, label = "*", size = 6) +
  annotate(geom = "text", x = 3.5, y = 416, label = "*", size = 6) +
  # time differences for MALES
  annotate(geom = "text", x = 2, y = 430, label = "A", size = 3) +
  annotate(geom = "text", x = 4, y = 430, label = "A", size = 3) +
  annotate(geom = "text", x = 6, y = 430, label = "B", size = 3) +
  # time differences for FEMALES
  annotate(geom = "text", x = 1, y = 430, label = "a", size = 3) +
  annotate(geom = "text", x = 3, y = 430, label = "a", size = 3) +
  annotate(geom = "text", x = 5, y = 430, label = "a", size = 3) +
  scale_color_manual(values = my_colors, name = "Sex") +
  scale_fill_manual(values = my_colors, name = "Sex") +
  scale_shape_manual(values = my_shapes_open, name = "Sex") +
  scale_x_discrete(labels = my_labels) +
  scale_y_continuous(limits = c(320, 440), breaks = c(320, 360, 400, 440)) +
  savs_ggplot_theme -> osml_emmean_plot
osml_emmean_plot
```




### CEWL

```{r}
ggplot() +
  geom_jitter(data = dat_repeats,
             aes(x = month_sex,
                 y = CEWL_g_m2h,
                 shape = sex_M_F,
                 color = sex_M_F,
                 fill = sex_M_F),
             alpha = 0.3,
             size = 0.9,
             position = position_jitter(height = 0, width = 0.2)) +
  geom_point(data = emmeans_all[emmeans_all$measurement == "CEWL",],
             aes(x = month_sex,
                 y = emmean,
                 shape = sex_M_F,
                 color = sex_M_F,
                 fill = sex_M_F),
             alpha = 1,
             size = 2) +
  geom_errorbar(data = emmeans_all[emmeans_all$measurement == "CEWL",],
                aes(x = month_sex,
                    y = emmean, 
                    ymin = lower.CL,
                    ymax = upper.CL,
                    color = sex_M_F),
                width = .4) +
  # sex differences
  annotate(geom = "text", x = 3.5, y = 16, label = "*", size = 6) +
  # time differences for MALES
  annotate(geom = "text", x = 2, y = 19, label = "A", size = 3) +
  annotate(geom = "text", x = 4, y = 19, label = "B", size = 3) +
  annotate(geom = "text", x = 6, y = 19, label = "A", size = 3) +
  # time differences for FEMALES
  annotate(geom = "text", x = 1, y = 19, label = "a", size = 3) +
  annotate(geom = "text", x = 3, y = 19, label = "a", size = 3) +
  annotate(geom = "text", x = 5, y = 19, label = "a", size = 3) +
  xlab("") + 
  ylab(bquote('CEWL (g '*m^-2*' '*h^-1*')')) +
  scale_color_manual(values = my_colors, name = "Sex") +
  scale_fill_manual(values = my_colors, name = "Sex") +
  scale_shape_manual(values = my_shapes_open, name = "Sex") +
  scale_x_discrete(labels = my_labels) +
  savs_ggplot_theme -> CEWL_emmean_plot
CEWL_emmean_plot
```



This is **only** for lizards that were recaptured and measured more than once, so I think these changes may reflect true seasonality in their water balance.



## Export Repeats-Only Multi-Panel Fig

Put in one plot together:

```{r}
ggarrange(CEWL_emmean_plot, 
          osml_emmean_plot, 
          mass_emmean_plot,
          SMI_emmean_plot,
          ncol = 4, nrow = 1,
#          ncol = 1, nrow = 3,
          labels = c("A", "B", "C", "D"),
          common.legend = TRUE,
          legend = "bottom"
          ) -> szn_change_multi_fig
#szn_change_multi_fig

ggsave(filename = "szn_change_multi_fig.pdf",
       plot = szn_change_multi_fig,
       path = "./results_figures",
       device = "pdf",
       dpi = 600,
       units = "mm",
       width = 200, height = 80
       #width = 80, height = 210
       )
```













## FULL Time*Sex Marginal Means

I'm going to do literally the same exact thing as the stats and figures in the section above, but now for **all of my data**, not just for the data on lizards with repeat measurements.

Check n's:

```{r}
dat %>%
  group_by(month, sex_M_F) %>%
  summarise(n = n())
```




### Mass

```{r}
full_time_sex_diffs_mass <- lmerTest::lmer(data = dat, mass_g ~ month*sex_M_F +
                                        (1|individual_ID))
full_time_sex_diffs_mass_aov <- data.frame(anova(full_time_sex_diffs_mass, 
                                                 type = "1", ddf = "Kenward-Roger")) %>%
  mutate(explanatory = factor(row.names(.)))

# mean values
full_emmeans_mass <- data.frame(emmeans(full_time_sex_diffs_mass, 
                                   pairwise ~ month | sex_M_F)$emmean) %>%
  mutate(measurement = "Mass")

# stat diffs by month
full_time_emmeans_mass <- data.frame(emmeans(full_time_sex_diffs_mass, 
                                   pairwise ~ month | sex_M_F)$contrasts) %>%
  mutate(measurement = "Mass")

# stat diffs by sex
full_sex_emmeans_mass <- data.frame(emmeans(full_time_sex_diffs_mass, 
                                   pairwise ~ sex_M_F | month)$contrasts) %>%
  mutate(measurement = "Mass")
```




### Body Condition

```{r}
full_time_sex_diffs_SMI <- lmerTest::lmer(data = dat, SMI ~ month*sex_M_F +
                                        (1|individual_ID))
full_time_sex_diffs_SMI_aov <- data.frame(anova(full_time_sex_diffs_SMI, 
                                          type = "1", ddf = "Kenward-Roger")) %>%
  mutate(explanatory = factor(row.names(.)))

# mean values
full_emmeans_SMI <- data.frame(emmeans(full_time_sex_diffs_SMI, 
                                   pairwise ~ month | sex_M_F)$emmean) %>%
  mutate(measurement = "SMI")

# stat diffs by month
full_time_emmeans_SMI <- data.frame(emmeans(full_time_sex_diffs_SMI, 
                                   pairwise ~ month | sex_M_F)$contrasts) %>%
  mutate(measurement = "SMI")

# stat diffs by sex
full_sex_emmeans_SMI <- data.frame(emmeans(full_time_sex_diffs_SMI, 
                                   pairwise ~ sex_M_F | month)$contrasts) %>%
  mutate(measurement = "SMI")
```



### Osmolality


```{r}
full_time_sex_diffs_osml <- lmerTest::lmer(data = dat, 
                                      osmolality_mmol_kg_mean ~ month*sex_M_F +
                                        (1|individual_ID))
full_time_sex_diffs_osml_aov <- data.frame(anova(full_time_sex_diffs_osml, 
                                           type = "1", ddf = "Kenward-Roger")) %>%
  mutate(explanatory = factor(row.names(.)))

# mean values
full_emmeans_osml <- data.frame(emmeans(full_time_sex_diffs_osml, 
                                   pairwise ~ month | sex_M_F)$emmean) %>%
  mutate(measurement = "Osmolality")

# stat diffs by month
full_time_emmeans_osml <- data.frame(emmeans(full_time_sex_diffs_osml, 
                                   pairwise ~ month | sex_M_F)$contrasts) %>%
  mutate(measurement = "Osmolality")

# stat diffs by sex
full_sex_emmeans_osml <- data.frame(emmeans(full_time_sex_diffs_osml, 
                                   pairwise ~ sex_M_F | month)$contrasts) %>%
  mutate(measurement = "Osmolality")
```




### CEWL

```{r}
full_time_sex_diffs_CEWL <- lmerTest::lmer(data = dat, 
                                      CEWL_g_m2h ~ month*sex_M_F +
                                        (1|individual_ID))
full_time_sex_diffs_CEWL_aov <- data.frame(anova(full_time_sex_diffs_CEWL, 
                                           type = "1", ddf = "Kenward-Roger")) %>%
  mutate(explanatory = factor(row.names(.)))

# check covariates
full_time_sex_diffs_CEWL_check_covaries <- lmerTest::lmer(data = dat, 
                                                     CEWL_g_m2h ~ month*sex_M_F
                                         + msmt_temp_C + msmt_VPD_kPa +
                                        (1|individual_ID))
anova(full_time_sex_diffs_CEWL_check_covaries, 
      type = "1", ddf = "Kenward-Roger")

# mean values
full_emmeans_CEWL <- data.frame(emmeans(full_time_sex_diffs_CEWL, 
                                   pairwise ~ month | sex_M_F)$emmean) %>%
  mutate(measurement = "CEWL")

# stat diffs by month
full_time_emmeans_CEWL <- data.frame(emmeans(full_time_sex_diffs_CEWL, 
                                   pairwise ~ month | sex_M_F)$contrasts) %>%
  mutate(measurement = "CEWL")

# stat diffs by sex
full_sex_emmeans_CEWL <- data.frame(emmeans(full_time_sex_diffs_CEWL, 
                                   pairwise ~ sex_M_F | month)$contrasts) %>%
  mutate(measurement = "CEWL")
```



## Check Assumptions

```{r}
plot(full_time_sex_diffs_CEWL)
plot(full_time_sex_diffs_osml)
plot(full_time_sex_diffs_mass)
plot(full_time_sex_diffs_SMI)
```



## Merge dfs

```{r}
full_emmeans_all <- full_emmeans_CEWL %>%
  rbind(full_emmeans_osml) %>%
  rbind(full_emmeans_mass) %>%
  rbind(full_emmeans_SMI) %>%
  mutate(month_sex = factor(paste(month, sex_M_F),
                            levels = c("April Female", "April Male",
                                       "May Female", "May Male",
                                       "July Female", "July Male")))
full_emmeans_F <- full_emmeans_all %>%
  dplyr::filter(sex_M_F == "Female")
full_emmeans_M <- full_emmeans_all %>%
  dplyr::filter(sex_M_F == "Male")

# all pairwise stats together
full_emmean_time_stats <- full_time_emmeans_CEWL %>%
  rbind(full_time_emmeans_osml) %>%
  rbind(full_time_emmeans_mass) %>%
  rbind(full_time_emmeans_SMI)
full_emmean_sex_stats <- full_sex_emmeans_CEWL %>%
  rbind(full_sex_emmeans_osml) %>%
  rbind(full_sex_emmeans_mass) %>%
  rbind(full_sex_emmeans_SMI)

# anova stats
full_time_sex_diffs_all <- (full_time_sex_diffs_CEWL_aov) %>%
  rbind((full_time_sex_diffs_osml_aov)) %>%
  rbind((full_time_sex_diffs_mass_aov)) %>%
  rbind((full_time_sex_diffs_SMI_aov)) %>%
  mutate(response = factor(c(rep("CEWL", 3), rep("Plasma Osmolality", 3),
                      rep("Mass", 3), rep("Body Condition", 3))))
summary(full_time_sex_diffs_all)
```



## Export Model Results

```{r}
full_time_sex_diffs_4exp <- full_time_sex_diffs_all %>%
  mutate(seq_sum_of_squares = round(Sum.Sq, 0), 
         F_statistic = round(F.value, 2),
         DenDF = round(DenDF, 0),
         F_full = paste(F_statistic, " (", NumDF, ",", DenDF, ")", sep = ""),
         p_value = round(Pr..F., 4)) %>%
  dplyr::select(response, explanatory,
                seq_sum_of_squares,
                #NumDF, DenDF,
                #F_statistic, 
                F_full,
                p_value)
write.csv(full_time_sex_diffs_4exp, 
          "./results_statistics/hydric_Fstats_by_monthsex.csv")
```
























## FULL Plot MMeans Time*Sex

### Mass

```{r}
ggplot() +
  geom_jitter(data = dat,
             aes(x = month_sex,
                 y = mass_g,
                 shape = sex_M_F,
                 color = sex_M_F,
                 fill = sex_M_F),
             alpha = 0.3,
             size = 0.9,
              position = position_jitter(height = 0, width = 0.2)) +
  geom_point(data = full_emmeans_all[full_emmeans_all$measurement == "Mass",],
             aes(x = month_sex,
                 y = emmean,
                 shape = sex_M_F,
                 color = sex_M_F,
                 fill = sex_M_F),
             alpha = 1,
             size = 2) +
  geom_errorbar(data = full_emmeans_all[full_emmeans_all$measurement == "Mass",],
                aes(x = month_sex,
                    y = emmean, 
                    ymin = lower.CL,
                    ymax = upper.CL,
                 color = sex_M_F),
                width = .4) +
  xlab("") + 
  ylab("Lizard Mass (g)") +
  # sex differences
  annotate(geom = "text", x = 5.5, y = 54, label = "*", size = 6) +
  # time differences for MALES
  annotate(geom = "text", x = 2, y = 61, label = "AB", size = 3) +
  annotate(geom = "text", x = 4, y = 61, label = "A", size = 3) +
  annotate(geom = "text", x = 6, y = 61, label = "B", size = 3) +
  # time differences for FEMALES
  annotate(geom = "text", x = 1, y = 61, label = "a", size = 3) +
  annotate(geom = "text", x = 3, y = 61, label = "b", size = 3) +
  annotate(geom = "text", x = 5, y = 61, label = "a", size = 3) +
  scale_color_manual(values = my_colors, name = "Sex") +
  scale_fill_manual(values = my_colors, name = "Sex") +
  scale_shape_manual(values = my_shapes_open, name = "Sex") +
  scale_x_discrete(labels = my_labels_full) +
  ylim(19, 61) +
  savs_ggplot_theme -> full_mass_emmean_plot
full_mass_emmean_plot
```


### Mass - F

```{r}
ggplot() +
  geom_jitter(data = dat_F,
             aes(x = month,
                 y = mass_g,
                 shape = sex_M_F,
                 color = sex_M_F,
                 fill = sex_M_F),
             alpha = 0.3,
             size = 0.9,
              position = position_jitter(height = 0, width = 0.2)) +
  geom_point(data = full_emmeans_F[full_emmeans_F$measurement == "Mass",],
             aes(x = month,
                 y = emmean,
                 shape = sex_M_F,
                 color = sex_M_F,
                 fill = sex_M_F),
             alpha = 1,
             size = 2) +
  geom_errorbar(data = full_emmeans_F[full_emmeans_F$measurement == "Mass",],
                aes(x = month,
                    y = emmean, 
                    ymin = lower.CL,
                    ymax = upper.CL,
                 color = sex_M_F),
                width = .4) +
  xlab("") + 
  ylab("Lizard Mass (g)") +
  # sex differences
  annotate(geom = "text", x = 3, y = 54, label = "*", size = 6) +
  # time differences for FEMALES
  annotate(geom = "text", x = 1, y = 61, label = "A", size = 3) +
  annotate(geom = "text", x = 2, y = 61, label = "B", size = 3) +
  annotate(geom = "text", x = 3, y = 61, label = "A", size = 3) +
  scale_color_manual(values = Fem, name = "Sex") +
  scale_fill_manual(values = Fem, name = "Sex") +
  scale_shape_manual(values = 19, name = "Sex") +
  scale_x_discrete(labels = my_labels_full_F) +
  ylim(19, 61) +
  savs_ggplot_theme -> full_mass_emmean_plot_F
full_mass_emmean_plot_F

ggsave(filename = "szn_change_mass_F_standalone.pdf",
       plot = full_mass_emmean_plot_F,
       path = "./results_figures",
       device = "pdf",
       dpi = 600,
       units = "mm",
       width = 60, height = 80
       )
```



### Mass - M

```{r}
ggplot() +
  geom_jitter(data = dat_M,
             aes(x = month,
                 y = mass_g,
                 shape = sex_M_F,
                 color = sex_M_F,
                 fill = sex_M_F),
             alpha = 0.3,
             size = 0.9,
              position = position_jitter(height = 0, width = 0.2)) +
  geom_point(data = full_emmeans_M[full_emmeans_M$measurement == "Mass",],
             aes(x = month,
                 y = emmean,
                 shape = sex_M_F,
                 color = sex_M_F,
                 fill = sex_M_F),
             alpha = 1,
             size = 2) +
  geom_errorbar(data = full_emmeans_M[full_emmeans_M$measurement == "Mass",],
                aes(x = month,
                    y = emmean, 
                    ymin = lower.CL,
                    ymax = upper.CL,
                 color = sex_M_F),
                width = .4) +
  xlab("") + 
  ylab("Lizard Mass (g)") +
  # sex differences
  annotate(geom = "text", x = 3, y = 54, label = "*", size = 6) +
  # time differences for MALES
  annotate(geom = "text", x = 1, y = 61, label = "AB", size = 3) +
  annotate(geom = "text", x = 2, y = 61, label = "A", size = 3) +
  annotate(geom = "text", x = 3, y = 61, label = "B", size = 3) +
  scale_color_manual(values = Male, name = "Sex") +
  scale_fill_manual(values = Male, name = "Sex") +
  scale_shape_manual(values = 15, name = "Sex") +
  scale_x_discrete(labels = my_labels_full_M) +
  ylim(19, 61) +
  savs_ggplot_theme -> full_mass_emmean_plot_M
full_mass_emmean_plot_M

ggsave(filename = "szn_change_mass_M_standalone.pdf",
       plot = full_mass_emmean_plot_M,
       path = "./results_figures",
       device = "pdf",
       dpi = 600,
       units = "mm",
       width = 60, height = 80
       )
```



### Body Condition

```{r}
ggplot() +
  geom_jitter(data = dat,
             aes(x = month_sex,
                 y = SMI,
                 shape = sex_M_F,
                 color = sex_M_F,
                 fill = sex_M_F),
             alpha = 0.3,
             size = 0.9,
              position = position_jitter(height = 0, width = 0.2)) +
  geom_point(data = full_emmeans_all[full_emmeans_all$measurement == "SMI",],
             aes(x = month_sex,
                 y = emmean,
                 shape = sex_M_F,
                 color = sex_M_F,
                 fill = sex_M_F),
             alpha = 1,
             size = 2) +
  geom_errorbar(data = full_emmeans_all[full_emmeans_all$measurement == "SMI",],
                aes(x = month_sex,
                    y = emmean, 
                    ymin = lower.CL,
                    ymax = upper.CL,
                 color = sex_M_F),
                width = .4) +
  xlab("") + 
  ylab("Body Condition (g')") +
  # sex differences
  annotate(geom = "text", x = 1.5, y = 44, label = "*", size = 6) +
  annotate(geom = "text", x = 3.5, y = 44, label = "*", size = 6) +
  # time differences for MALES
  annotate(geom = "text", x = 2, y = 49, label = "A", size = 3) +
  annotate(geom = "text", x = 4, y = 49, label = "A", size = 3) +
  annotate(geom = "text", x = 6, y = 49, label = "B", size = 3) +
  # time differences for FEMALES
  annotate(geom = "text", x = 1, y = 49, label = "a", size = 3) +
  annotate(geom = "text", x = 3, y = 49, label = "b", size = 3) +
  annotate(geom = "text", x = 5, y = 49, label = "a", size = 3) +
  scale_color_manual(values = my_colors, name = "Sex") +
  scale_fill_manual(values = my_colors, name = "Sex") +
  scale_shape_manual(values = my_shapes_open, name = "Sex") +
  scale_x_discrete(labels = my_labels_full) +
  ylim(19, 50) +
  savs_ggplot_theme -> full_SMI_emmean_plot
full_SMI_emmean_plot
```






### Body Cond - F

```{r}
ggplot() +
  geom_jitter(data = dat_F,
             aes(x = month,
                 y = SMI,
                 shape = sex_M_F,
                 color = sex_M_F,
                 fill = sex_M_F),
             alpha = 0.3,
             size = 0.9,
              position = position_jitter(height = 0, width = 0.2)) +
  geom_point(data = full_emmeans_F[full_emmeans_F$measurement == "SMI",],
             aes(x = month,
                 y = emmean,
                 shape = sex_M_F,
                 color = sex_M_F,
                 fill = sex_M_F),
             alpha = 1,
             size = 2) +
  geom_errorbar(data = full_emmeans_F[full_emmeans_F$measurement == "SMI",],
                aes(x = month,
                    y = emmean, 
                    ymin = lower.CL,
                    ymax = upper.CL,
                 color = sex_M_F),
                width = .4) +
  xlab("") + 
  ylab("Body Condition (g')") +
  # sex differences
  annotate(geom = "text", x = 1, y = 47, label = "*", size = 6) +
  annotate(geom = "text", x = 2, y = 47, label = "*", size = 6) +
  # time differences for FEMALES
  annotate(geom = "text", x = 1, y = 50, label = "A", size = 3) +
  annotate(geom = "text", x = 2, y = 50, label = "B", size = 3) +
  annotate(geom = "text", x = 3, y = 50, label = "A", size = 3) +
  scale_color_manual(values = Fem, name = NULL) +
  scale_fill_manual(values = Fem, name = NULL) +
  scale_shape_manual(values = 21, name = NULL) +
  scale_x_discrete(labels = my_labels_full_F) +
  ylim(19, 50) +
  savs_ggplot_theme +
  theme(plot.margin = margin(t = 0, r = 0, b = 0, l = 10, unit = "pt"),
        legend.margin = margin(0,0,0,0, unit = "pt")) -> full_SMI_emmean_plot_F
full_SMI_emmean_plot_F

ggsave(filename = "szn_change_bodycond_F_standalone.pdf",
       plot = full_SMI_emmean_plot_F,
       path = "./results_figures",
       device = "pdf",
       dpi = 600,
       units = "mm",
       width = 60, height = 80
       )
```








### Body Cond - M

```{r}
ggplot() +
  geom_jitter(data = dat_M,
             aes(x = month,
                 y = SMI,
                 shape = sex_M_F,
                 color = sex_M_F,
                 fill = sex_M_F),
             alpha = 0.3,
             size = 0.9,
              position = position_jitter(height = 0, width = 0.2)) +
  geom_point(data = full_emmeans_M[full_emmeans_M$measurement == "SMI",],
             aes(x = month,
                 y = emmean,
                 shape = sex_M_F,
                 color = sex_M_F,
                 fill = sex_M_F),
             alpha = 1,
             size = 2) +
  geom_errorbar(data = full_emmeans_M[full_emmeans_M$measurement == "SMI",],
                aes(x = month,
                    y = emmean, 
                    ymin = lower.CL,
                    ymax = upper.CL,
                 color = sex_M_F),
                width = .4) +
  xlab("") + 
  ylab("Body Condition (g')") +
  # sex differences
  annotate(geom = "text", x = 1, y = 47, label = "*", size = 6) +
  annotate(geom = "text", x = 2, y = 47, label = "*", size = 6) +
  # time differences for MALES
  annotate(geom = "text", x = 1, y = 50, label = "A", size = 3) +
  annotate(geom = "text", x = 2, y = 50, label = "A", size = 3) +
  annotate(geom = "text", x = 3, y = 50, label = "B", size = 3) +
  scale_color_manual(values = Male, name = NULL) +
  scale_fill_manual(values = Male, name = NULL) +
  scale_shape_manual(values = 22, name = NULL) +
  scale_x_discrete(labels = my_labels_full_M) +
  ylim(19, 50) +
  savs_ggplot_theme  +
  theme(plot.margin = margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"),
        legend.margin = margin(0,0,0,0, unit = "pt")) -> full_SMI_emmean_plot_M
full_SMI_emmean_plot_M

ggsave(filename = "szn_change_bodycond_M_standalone.pdf",
       plot = full_SMI_emmean_plot_M,
       path = "./results_figures",
       device = "pdf",
       dpi = 600,
       units = "mm",
       width = 60, height = 80
       )
```



### Osmolality

```{r}
ggplot() +
  geom_jitter(data = dat,
             aes(x = month_sex,
                 y = osmolality_mmol_kg_mean,
                 shape = sex_M_F,
                 color = sex_M_F,
                 fill = sex_M_F),
             alpha = 0.3,
             size = 0.9,
              position = position_jitter(height = 0, width = 0.2)) +
  geom_point(data = full_emmeans_all[full_emmeans_all$measurement == "Osmolality",],
             aes(x = month_sex,
                 y = emmean,
                 shape = sex_M_F,
                 color = sex_M_F,
                 fill = sex_M_F),
             alpha = 1,
             size = 2) +
  geom_errorbar(data = full_emmeans_all[full_emmeans_all$measurement == "Osmolality",],
                aes(x = month_sex,
                    y = emmean, 
                    ymin = lower.CL,
                    ymax = upper.CL,
                 color = sex_M_F),
                width = .4) +
  xlab("") + 
  ylab(bquote('Osmolality (mmol '*kg^-1*')')) +
  # sex differences
  annotate(geom = "text", x = 1.5, y = 422, label = "*", size = 6) +
  # time differences for MALES
  annotate(geom = "text", x = 2, y = 445, label = "AB", size = 3) +
  annotate(geom = "text", x = 4, y = 445, label = "A", size = 3) +
  annotate(geom = "text", x = 6, y = 445, label = "B", size = 3) +
  # time differences for FEMALES
  annotate(geom = "text", x = 1, y = 445, label = "a", size = 3) +
  annotate(geom = "text", x = 3, y = 445, label = "a", size = 3) +
  annotate(geom = "text", x = 5, y = 445, label = "a", size = 3) +
  scale_color_manual(values = my_colors, name = "Sex") +
  scale_fill_manual(values = my_colors, name = "Sex") +
  scale_shape_manual(values = my_shapes_open, name = "Sex") +
  scale_x_discrete(labels = my_labels_full) +
  scale_y_continuous(limits = c(320, 450), breaks = c(320, 360, 400, 440)) +
  savs_ggplot_theme -> full_osml_emmean_plot
full_osml_emmean_plot
```



### Osmolality - F

```{r}
ggplot() +
  geom_jitter(data = dat_F,
             aes(x = month,
                 y = osmolality_mmol_kg_mean,
                 shape = sex_M_F,
                 color = sex_M_F,
                 fill = sex_M_F),
             alpha = 0.3,
             size = 0.9,
              position = position_jitter(height = 0, width = 0.2)) +
  geom_point(data = full_emmeans_F[full_emmeans_F$measurement == "Osmolality",],
             aes(x = month,
                 y = emmean,
                 shape = sex_M_F,
                 color = sex_M_F,
                 fill = sex_M_F),
             alpha = 1,
             size = 2) +
  geom_errorbar(data = full_emmeans_F[full_emmeans_F$measurement == "Osmolality",],
                aes(x = month,
                    y = emmean, 
                    ymin = lower.CL,
                    ymax = upper.CL,
                 color = sex_M_F),
                width = .4) +
  xlab("") + 
  ylab(bquote('Osmolality (mmol '*kg^-1*')')) +
  # sex differences
  annotate(geom = "text", x = 1, y = 435, label = "*", size = 6) +
  # time differences for FEMALES
  annotate(geom = "text", x = 1, y = 448, label = "A", size = 3) +
  annotate(geom = "text", x = 2, y = 448, label = "A", size = 3) +
  annotate(geom = "text", x = 3, y = 448, label = "A", size = 3) +
  scale_color_manual(values = Fem, name = "Sex") +
  scale_fill_manual(values = Fem, name = "Sex") +
  scale_shape_manual(values = 21, name = "Sex") +
  scale_x_discrete(labels = my_labels_full_F) +
  scale_y_continuous(limits = c(320, 450), breaks = c(320, 360, 400, 440)) +
  savs_ggplot_theme +
  theme(plot.margin = margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"),
        legend.margin = margin(0,0,0,0, unit = "pt")) -> full_osml_emmean_plot_F
full_osml_emmean_plot_F

ggsave(filename = "szn_change_osml_F_standalone.pdf",
       plot = full_osml_emmean_plot_F,
       path = "./results_figures",
       device = "pdf",
       dpi = 600,
       units = "mm",
       width = 60, height = 80
       )
```




### Osmolality - M

```{r}
ggplot() +
  geom_jitter(data = dat_M,
             aes(x = month,
                 y = osmolality_mmol_kg_mean,
                 shape = sex_M_F,
                 color = sex_M_F,
                 fill = sex_M_F),
             alpha = 0.3,
             size = 0.9,
              position = position_jitter(height = 0, width = 0.2)) +
  geom_point(data = full_emmeans_M[full_emmeans_M$measurement == "Osmolality",],
             aes(x = month,
                 y = emmean,
                 shape = sex_M_F,
                 color = sex_M_F,
                 fill = sex_M_F),
             alpha = 1,
             size = 2) +
  geom_errorbar(data = full_emmeans_M[full_emmeans_M$measurement == "Osmolality",],
                aes(x = month,
                    y = emmean, 
                    ymin = lower.CL,
                    ymax = upper.CL,
                 color = sex_M_F),
                width = .4) +
  xlab("") + 
  ylab(bquote('Osmolality (mmol '*kg^-1*')')) +
  # sex differences
  annotate(geom = "text", x = 1, y = 435, label = "*", size = 6) +
  # time differences for MALES
  annotate(geom = "text", x = 1, y = 448, label = "AB", size = 3) +
  annotate(geom = "text", x = 2, y = 448, label = "A", size = 3) +
  annotate(geom = "text", x = 3, y = 448, label = "B", size = 3) +
  scale_color_manual(values = Male, name = "Sex") +
  scale_fill_manual(values = Male, name = "Sex") +
  scale_shape_manual(values = 22, name = "Sex") +
  scale_x_discrete(labels = my_labels_full_M) +
  scale_y_continuous(limits = c(320, 450), breaks = c(320, 360, 400, 440)) +
  savs_ggplot_theme +
  theme(plot.margin = margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"),
        legend.margin = margin(0,0,0,0, unit = "pt")) -> full_osml_emmean_plot_M
full_osml_emmean_plot_M

ggsave(filename = "szn_change_osml_M_standalone.pdf",
       plot = full_osml_emmean_plot_M,
       path = "./results_figures",
       device = "pdf",
       dpi = 600,
       units = "mm",
       width = 60, height = 80
       )
```




### CEWL

```{r}
ggplot() +
  geom_jitter(data = dat,
             aes(x = month_sex,
                 y = CEWL_g_m2h,
                 shape = sex_M_F,
                 color = sex_M_F,
                 fill = sex_M_F),
             alpha = 0.3,
             size = 0.9,
             position = position_jitter(height = 0, width = 0.2)) +
  geom_point(data = full_emmeans_all[full_emmeans_all$measurement == "CEWL",],
             aes(x = month_sex,
                 y = emmean,
                 shape = sex_M_F,
                 color = sex_M_F,
                 fill = sex_M_F),
             alpha = 1,
             size = 2) +
  geom_errorbar(data = full_emmeans_all[full_emmeans_all$measurement == "CEWL",],
                aes(x = month_sex,
                    y = emmean, 
                    ymin = lower.CL,
                    ymax = upper.CL,
                    color = sex_M_F),
                width = .4) +
  # sex differences
  annotate(geom = "text", x = 3.5, y = 20, label = "*", size = 6) +
  # time differences for MALES
  annotate(geom = "text", x = 2, y = 24, label = "A", size = 3) +
  annotate(geom = "text", x = 4, y = 24, label = "B", size = 3) +
  annotate(geom = "text", x = 6, y = 24, label = "A", size = 3) +
  # time differences for FEMALES = none
  annotate(geom = "text", x = 1, y = 24, label = "a", size = 3) +
  annotate(geom = "text", x = 3, y = 24, label = "a", size = 3) +
  annotate(geom = "text", x = 5, y = 24, label = "a", size = 3) +
  xlab("") + 
  ylab(bquote('CEWL (g '*m^-2*' '*h^-1*')')) +
  ylim(0, 25) +
  scale_color_manual(values = my_colors, name = "Sex") +
  scale_fill_manual(values = my_colors, name = "Sex") +
  scale_shape_manual(values = my_shapes_open, name = "Sex") +
  scale_x_discrete(labels = my_labels_full) +
  savs_ggplot_theme -> full_CEWL_emmean_plot
full_CEWL_emmean_plot
```




### CEWL - F

```{r}
ggplot() +
  geom_jitter(data = dat_F,
             aes(x = month,
                 y = CEWL_g_m2h,
                 shape = sex_M_F,
                 color = sex_M_F,
                 fill = sex_M_F),
             alpha = 0.3,
             size = 0.9,
             position = position_jitter(height = 0, width = 0.2)) +
  geom_point(data = full_emmeans_F[full_emmeans_F$measurement == "CEWL",],
             aes(x = month,
                 y = emmean,
                 shape = sex_M_F,
                 color = sex_M_F,
                 fill = sex_M_F),
             alpha = 1,
             size = 2) +
  geom_errorbar(data = full_emmeans_F[full_emmeans_F$measurement == "CEWL",],
                aes(x = month,
                    y = emmean, 
                    ymin = lower.CL,
                    ymax = upper.CL,
                    color = sex_M_F),
                width = .4) +
  # sex differences
  annotate(geom = "text", x = 2, y = 22.5, label = "*", size = 6) +
  # time differences for FEMALES = none
  annotate(geom = "text", x = 1, y = 25, label = "A", size = 3) +
  annotate(geom = "text", x = 2, y = 25, label = "A", size = 3) +
  annotate(geom = "text", x = 3, y = 25, label = "A", size = 3) +
  xlab("") + 
  ylab(bquote('CEWL (g '*m^-2*' '*h^-1*')')) +
  ylim(0, 25) +
  scale_color_manual(values = Fem, name = "Sex") +
  scale_fill_manual(values = Fem, name = "Sex") +
  scale_shape_manual(values = 21, name = "Sex") +
  scale_x_discrete(labels = my_labels_full_F) +
  savs_ggplot_theme +
  theme(plot.margin = margin(t = 0, r = 0, b = 0, l = 4.5, unit = "pt"),
        legend.margin = margin(0,0,0,0, unit = "pt")) -> full_CEWL_emmean_plot_F
full_CEWL_emmean_plot_F

ggsave(filename = "szn_change_CEWL_F_standalone.pdf",
       plot = full_CEWL_emmean_plot_F,
       path = "./results_figures",
       device = "pdf",
       dpi = 600,
       units = "mm",
       width = 60, height = 80
       )
```






### CEWL - M

```{r}
ggplot() +
  geom_jitter(data = dat_M,
             aes(x = month,
                 y = CEWL_g_m2h,
                 shape = sex_M_F,
                 color = sex_M_F,
                 fill = sex_M_F),
             alpha = 0.3,
             size = 0.9,
             position = position_jitter(height = 0, width = 0.2)) +
  geom_point(data = full_emmeans_M[full_emmeans_M$measurement == "CEWL",],
             aes(x = month,
                 y = emmean,
                 shape = sex_M_F,
                 color = sex_M_F,
                 fill = sex_M_F),
             alpha = 1,
             size = 2) +
  geom_errorbar(data = full_emmeans_M[full_emmeans_M$measurement == "CEWL",],
                aes(x = month,
                    y = emmean, 
                    ymin = lower.CL,
                    ymax = upper.CL,
                    color = sex_M_F),
                width = .4) +
  # sex differences
  annotate(geom = "text", x = 2, y = 22.5, label = "*", size = 6) +
  # time differences for MALES
  annotate(geom = "text", x = 1, y = 25, label = "A", size = 3) +
  annotate(geom = "text", x = 2, y = 25, label = "B", size = 3) +
  annotate(geom = "text", x = 3, y = 25, label = "A", size = 3) +
  xlab("") + 
  ylab(bquote('CEWL (g '*m^-2*' '*h^-1*')')) +
  ylim(0, 25) +
  scale_color_manual(values = Male, name = "Sex") +
  scale_fill_manual(values = Male, name = "Sex") +
  scale_shape_manual(values = 22, name = "Sex") +
  scale_x_discrete(labels = my_labels_full_M) +
  savs_ggplot_theme +
  theme(plot.margin = margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"),
        legend.margin = margin(0,0,0,0, unit = "pt")) -> full_CEWL_emmean_plot_M
full_CEWL_emmean_plot_M

ggsave(filename = "szn_change_CEWL_M_standalone.pdf",
       plot = full_CEWL_emmean_plot_M,
       path = "./results_figures",
       device = "pdf",
       dpi = 600,
       units = "mm",
       width = 60, height = 80
       )
```





## Arrange and Export M&F Separate Panel Plot


```{r}
# CEWL
full_CEWL_emmean_plot_M_multi <- full_CEWL_emmean_plot_M + 
  theme(axis.text.y = element_blank(),
        axis.ticks.y = element_blank(),
        axis.text.x = element_blank(),
        axis.ticks.x = element_blank(),
        legend.position = "none") +
  labs(y = NULL)
full_CEWL_emmean_plot_F_multi <- full_CEWL_emmean_plot_F + 
  theme(axis.text.x = element_blank(),
        axis.ticks.x = element_blank(),
        legend.position = "none")
# osmolality
full_osml_emmean_plot_M_multi <- full_osml_emmean_plot_M + 
  theme(axis.text.y = element_blank(),
        axis.ticks.y = element_blank(),
        axis.text.x = element_blank(),
        axis.ticks.x = element_blank(),
        legend.position = "none") +
  labs(y = NULL)
full_osml_emmean_plot_F_multi <- full_osml_emmean_plot_F + 
  theme(axis.text.x = element_blank(),
        axis.ticks.x = element_blank(),
        legend.position = "none")
# body condition
full_SMI_emmean_plot_M_multi <- full_SMI_emmean_plot_M + 
  theme(axis.text.y = element_blank(),
        axis.ticks.y = element_blank()) +
  labs(y = NULL)

# arrange M & F together
ggarrange(full_CEWL_emmean_plot_F_multi, full_CEWL_emmean_plot_M_multi,
          full_osml_emmean_plot_F_multi, full_osml_emmean_plot_M_multi,
          full_SMI_emmean_plot_F, full_SMI_emmean_plot_M_multi,
          ncol = 2, nrow = 3,
          widths = c(1.36, 1), # make x-axis widths match when exported
          heights = c(1, 1, 1.29), # heights
          labels = c("A", "", "B", "", "C", ""),
          label.y = c(1.02, 1.02, 1.02)
          #common.legend = TRUE,
          #legend = "bottom"
          ) -> full_szn_change_multi_fig
#full_szn_change_multi_fig

ggsave(filename = "szn_change_multi_fig.pdf",
       plot = full_szn_change_multi_fig,
       path = "./results_figures",
       device = "pdf",
       dpi = 600,
       units = "mm",
       width = 80, height = 190
       )
```



## Export Full Data Multi-Panel Fig


```{r}
ggarrange(full_CEWL_emmean_plot, 
          full_osml_emmean_plot, 
          #full_mass_emmean_plot,
          full_SMI_emmean_plot,
          ncol = 3, nrow = 1,
          #ncol = 1, nrow = 3,
          labels = c("A", "B", "C"),
          common.legend = TRUE,
          legend = "bottom"
          ) -> full_szn_change_multi_fig
#full_szn_change_multi_fig

ggsave(filename = "szn_change_multi_fig_full_horizontal.pdf",
       plot = full_szn_change_multi_fig,
       path = "./results_figures",
       device = "pdf",
       dpi = 600,
       units = "mm",
       width = 220, height = 80
       #width = 80, height = 210
       )
```




## Export Full & Repeats Multi-Panel Fig


```{r}
ggarrange(full_CEWL_emmean_plot, 
          full_osml_emmean_plot, 
          full_mass_emmean_plot,
          full_SMI_emmean_plot,
          CEWL_emmean_plot, 
          osml_emmean_plot, 
          mass_emmean_plot,
          SMI_emmean_plot,
          ncol = 4, nrow = 2,
#          ncol = 1, nrow = 3,
          labels = c("full", "full", "full", "full",
                     "rep", "rep", "rep", "rep"),
          common.legend = TRUE,
          legend = "bottom"
          ) -> full_vs_rep_szn_change_multi_fig
#full_vs_rep_szn_change_multi_fig

#ggsave(filename = "szn_change_multi_fig_full_vs_rep.pdf",
 #      plot = full_vs_rep_szn_change_multi_fig,
  #     path = "./results_figures",
   #    device = "pdf",
    #   dpi = 600,
     #  units = "mm",
      # width = 210, height = 160
       ##width = 80, height = 210
       #)
```










# Reproductive Effort

Is reproductive effort related to water balance?



## Egg Investment

```{r}
summary(dat_repeat_females)
dat_repeat_females_eggs <- dat_repeat_females %>% 
  dplyr::filter(gravid_Y_N == "Gravid") %>% 
  dplyr::filter(month == "May") # so we don't have any repeats

summary(lm(data = dat_repeat_females_eggs, number_eggs ~ mass_g))
summary(lm(data = dat_repeat_females_eggs, number_eggs ~ SVL_mm))
summary(lm(data = dat_repeat_females_eggs, number_eggs ~ SMI))

anova(lm(data = dat_repeat_females_eggs, number_eggs ~ mass_g))
anova(lm(data = dat_repeat_females_eggs, number_eggs ~ SVL_mm))
```



## Repeat Individuals

I have 9 females measured at both April and May time points. Let's see if their physiology changes consistently based on becoming gravid. 


First, calculate the change in CEWL, osmolality, and mass for each of those females between April to May.

```{r}
fem_starting_values <- dat_repeat_females %>%
  # get the values for April measurements only 
  dplyr::filter(month == "April") %>%
  dplyr::select(individual_ID,
                CEWL_April = CEWL_g_m2h,
                osml_April = osmolality_mmol_kg_mean,
                mass_April = mass_g,
                SMI_April = SMI)
fem_change <- dat_repeat_females %>%
  # add starting values
  left_join(fem_starting_values, by = 'individual_ID') %>%
  # make sure we have complete data
  dplyr::filter(complete.cases(mass_April, CEWL_April)) %>%
  # calculate difference for each msmt versus in April
  mutate(mass_change_from_April = mass_g - mass_April,
         SMI_change_from_April = SMI - SMI_April,
         CEWL_change_from_April = CEWL_g_m2h - CEWL_April,
         osml_change_from_April = osmolality_mmol_kg_mean - osml_April)
summary(fem_change)
```



## Plot Indiv Change

```{r}
ggplot(fem_change) +
  aes(x = month,
      y = mass_change_from_April,
      group = individual_ID,
      color = gravid_Y_N
      ) +
  geom_point() +
  geom_line() +
  theme_bw()
ggplot(fem_change) +
  aes(x = month,
      y = CEWL_change_from_April,
      group = individual_ID,
      color = gravid_Y_N
      ) +
  geom_point() +
  geom_line() +
  theme_bw()
ggplot(fem_change) +
  aes(x = month,
      y = osml_change_from_April,
      group = individual_ID,
      color = gravid_Y_N
      ) +
  geom_point() +
  geom_line() +
  theme_bw()
boxplot(fem_change$osml_change_from_April)
boxplot(fem_change$mass_change_from_April)
```


On average, mass and osmolality both increase. There's only one lizard who was not gravid at both time points, so we can't compare change based on becoming gravid or not. I think it is reasonable to conclude that on average, gravid females gained mass and became less hydrated. But, we cannot say that this was DUE to gravidity, because we have nothing to compare it to


## Stats Indiv Change

Run stats tests on the change rates for only the females who were gravid in May, and use only the actual delta values, in their rows for May data.

```{r}
# check osml outlier range
fem_change %>%
  group_by(month) %>%
  summarise(mean(osml_change_from_April), sd(osml_change_from_April))

# for stats
fem_change_stats <- fem_change %>%
  # don't use the one female still non-gravid in May
  dplyr::filter(individual_ID != "F-12") %>%
  # only use the >resulting< change values
  dplyr::filter(month == "May") %>%
  # remove the crazy low outlier based on sd calculated above
  dplyr::filter(osml_change_from_April > (12-(29*2)))
```


ttests:

```{r}
t.test(fem_change_stats$CEWL_change_from_April)
t.test(fem_change_stats$osml_change_from_April)
t.test(fem_change_stats$mass_change_from_April)
t.test(fem_change_stats$SMI_change_from_April)
```




## Stats Likelihood

Does anything correlate with the likelihood of being/becoming gravid?


Start with trying each possible logistic model to predict gravidity:

```{r}
repro_logit1 <- glm(gravid_Y_N ~ 
                     mass_g, 
                   data = dat_repro_females, 
                   family = "binomial")
repro_logit2 <- glm(gravid_Y_N ~ 
                     SMI, 
                   data = dat_repro_females, 
                   family = "binomial")
repro_logit3 <- glm(gravid_Y_N ~ 
                     osmolality_mmol_kg_mean, 
                   data = dat_repro_females, 
                   family = "binomial")
repro_logit4 <- glm(gravid_Y_N ~ 
                     CEWL_g_m2h, 
                   data = dat_repro_females, 
                   family = "binomial")
car::Anova(repro_logit1, type = 2, test.statistic = "Wald", error.estimate = "pearson")
car::Anova(repro_logit2, type = 2, test.statistic = "Wald", error.estimate = "pearson")
car::Anova(repro_logit3, type = 2, test.statistic = "Wald", error.estimate = "pearson")
car::Anova(repro_logit4, type = 2, test.statistic = "Wald", error.estimate = "pearson")
```

What about an ANOVA?


## Plot Likelihood Gravid ~ Mass

```{r}
dat_repro_females %>%
  # dummy-fy gravid variable
  mutate(gravid_Y_N = factor(gravid_Y_N, levels = c("Not Gravid", "Gravid"),
                             labels = c(0,1)),
         # goes 1-2, so fix to be 0-1
         gravid_Y_N = as.numeric(gravid_Y_N)-1) %>%
  # nooooowwwww I can plot and the stat_smooth will actually work
  ggplot() +
  aes(x = mass_g, 
      y = gravid_Y_N) +
  geom_jitter(alpha=.5, 
              position = position_jitter(height = 0.1, width = 0)
              ) +
  # must make response variable 0-1 in order for this to work
  stat_smooth(geom = "smooth",
              method = "glm", 
              formula = y~x,
              se = FALSE, 
              method.args = list(family = "quasibinomial")
              ) +
  ylab("") +
  scale_y_continuous(labels = c("Not Gravid", "", "", "", "Gravid"), 
                     limits = c(0,1)) +
  xlab("Body Mass (g)") +
  savs_ggplot_theme
```








## Summary Figure


```{r}
dodger <- position_dodge(width = 0.2) # make dodge amt for both points and lines

dat_repro_females %>%
  # only use data for April-May
  dplyr::filter(month %in% c("April", "May")) %>% 
  ggplot() +
    aes(x = month,
        y = mass_g,
        color = gravid_Y_N,
        shape = gravid_Y_N,
        alpha = gravid_Y_N,
        group = individual_ID) +
  geom_line(position = dodger) +
  geom_point(size = 2,
              position = dodger, #position_jitter(height = 0.01, width = 0),
             # alpha = 0.5
             ) +
  labs(y = "Body Mass (g)",
       x = NULL) +
  scale_color_manual(values = c(Fem_nongrav, Fem_grav), name = NULL) +
  scale_shape_manual(values = c(19, 19), name = NULL) +
  scale_alpha_manual(values = c(0.3, 0.7), name = NULL) +
  savs_ggplot_theme +
  theme(legend.position = "right",
        plot.margin = margin(t = 1.5, r = 0.5, b = 0.5, l = 0.5, unit = "pt"),
        legend.margin = margin(0,0,0,0, unit = "pt")) -> when_gravid
when_gravid

ggsave(filename = "female_gravidity.pdf",
       plot = when_gravid,
       path = "./results_figures",
       device = "pdf",
       dpi = 600,
       units = "mm",
       #width = 200, height = 80
       width = 80, height = 60
       )
```























